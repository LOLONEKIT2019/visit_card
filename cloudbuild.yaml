steps:

  - name: golang:1.17
    entrypoint: /bin/bash
    args:
      - ./test.sh
    id: test

  - name: golang:1.17
    entrypoint: /bin/bash
    args:
      - ./build.sh
    id: build
    waitFor:
      - test

  - name: 'gcr.io/cloud-builders/docker'
    args: [
      'build',
      '-t',
      'europe-central2-docker.pkg.dev/$PROJECT_ID/$_REPO_NAME/$_IMAGE_NAME:$SHORT_SHA',
      './tmp'
    ]

substitutions:
  _FUNCTION_PROJECT : astahov-prod
  _IMAGE_NAME   : visit-card

